# Project Name: Express MongoDB API

This is a simple RESTful API built with Express and MongoDB. It allows users to upload images, store them in the database, and automatically generate alt-text descriptions for those images using the Google Gemini AI model.

## Table of Contents

1. [Features](#features)
2. [Prerequisites](#prerequisites)
3. [Setup](#setup)
4. [Running the Application Locally](#running-the-application-locally)
5. [API Endpoints](#api-endpoints)
   - [GET /posts](#1-get-posts)
   - [POST /posts](#2-post-posts)
   - [POST /upload](#3-post-upload)
   - [PUT /upload/:id](#4-put-uploadid)
6. [Generating Image Descriptions](#generating-image-descriptions)
7. [File Structure](#file-structure)
8. [Project Configuration](#project-configuration)
9. [Troubleshooting](#troubleshooting)
10. [Front-End Examples](#front-end-examples)
11. [License](#license)



## Features

- **List Posts**: Retrieve all posts stored in MongoDB.
- **Create Post**: Create a new post with associated image.
- **Update Post**: Update an existing post with new information or image.
- **Upload Image**: Upload an image for later processing (e.g., generate a description).
- **Generate Image Description**: Uses the Gemini AI model to generate a description for an uploaded image.

## Prerequisites

Before starting the application, make sure to have the following installed:

- **Node.js**: [Install Node.js](https://nodejs.org/en/download/)
- **MongoDB Atlas**: [Set up a free cluster on MongoDB Atlas](https://www.mongodb.com/cloud/atlas) (cloud-based, fully managed MongoDB service).
- **Google Gemini API Key**: You must have access to the [Google Gemini API](https://aistudio.google.com/app/apikey?utm_source=website&utm_medium=referral&utm_campaign=Alura-dev-backend-immersion&utm_content=) and an API key.

## Setup

1. Clone the repository:

    ```bash
    git clone https://github.com/enricoluisi/express-mongo-api
    cd express-mongo-api
    ```

2. Install the dependencies:

    ```bash
    npm install
    ```

3. Create a `.env` file in the root directory of your project and add the following:

    ```bash
    GEMINI_API_KEY=your-google-gemini-api-key
    STRING_CONNECTION=your-mongodb-connection-string
    ```

    Replace `your-google-gemini-api-key` with your actual Gemini API key and `your-mongodb-connection-string` with the MongoDB connection string.

## Running the Application Locally

To run the application locally, use the following command:

```bash
npm run dev
```
### This will start the server and watch for file changes.

**Port:** The server will be accessible at [http://localhost:3000](http://localhost:3000).

**Static files:** Files uploaded to the `/uploads` directory can be accessed directly via URL.

**Note:** The API does not return data when accessing the root URL (`http://localhost:3000`). Instead, it responds to the `/posts` endpoint for interacting with posts.

## API Endpoints

### 1. GET /posts
- **Description:** Retrieve all posts stored in the MongoDB database.
- **Response:** Returns a list of posts in JSON format.

### 2. POST /posts
**Description**: Create a new post.  
**Request Body**:
```json
{
    "description": "Description of the post",
    "imgURL": "url_of_the_uploaded_image",
    "alt": "generated alt text for the image"
}
```
**Response**: Returns the created post.

### 3. POST /upload
- **Description**: Upload an image.
**Request**: A form-data request with an image file (e.g., PNG, JPG).

**Response**:
```json
{
    "acknowledged": true,
    "insertedId": "<generated_ID_by_MongoDB>"
}
```
**Explanation**: This response confirms that the post was successfully created in the database. The insertedId is the unique identifier generated by MongoDB for the newly created post.

### 4. PUT /upload/:id
- **Description**: Update a new post image and generate an alt-text description using the Google Gemini AI model. This endpoint updates an existing post with a new image and its generated description (alt-text).
**Request Body**:
```json
{
    "alt": "Generated description for the image"
}
```
**Response**:
```json
{
    "acknowledged": true,
    "modifiedCount": 1,
    "upsertedId": null,
    "upsertedCount": 0,
    "matchedCount": 1
}
```

![Example of a PUT request to update an image](https://github.com/user-attachments/assets/5ebcccb7-4bbd-4142-a2ca-faa62281151d)
![GET POSTS](https://github.com/user-attachments/assets/b0f1d1a0-b7b9-43f8-a5e8-75bd4942cfc8)

### Generating Image Descriptions
The /upload endpoint uses the Google Gemini AI model to automatically generate an alt-text description for uploaded images. This description is saved alongside the image in the database and can be retrieved through the corresponding post's data.


## File Structure
- `server.js`: Main entry point of the application. Sets up the Express server and routes.
- `src/routes/postsRoutes.js`: Defines routes related to posts and image uploads.
- `src/controllers/postsController.js`: Contains the business logic for handling the routes.
- `src/services/geminiService.js`: Service for interacting with the Google Gemini API to generate image descriptions.
- `src/models/postsModel.js`: Defines the database interactions for posts using MongoDB.

## Project Configuration
The project is configured with the following dependencies:

- **express**: Web framework to handle HTTP requests.
- **multer**: Middleware to handle file uploads.
- **mongodb**: MongoDB driver for database interactions.
- **dotenv**: Loads environment variables from the .env file.
- **@google/generative-ai**: Google Gemini API for generating content from images.

## Troubleshooting
- If you encounter any issues with the Google Gemini API, make sure your API key is correctly set in the `.env` file.
- If there are issues connecting to MongoDB, verify your connection string is correct and MongoDB is running.

## Authors

This project is maintained by:

- **Enrico Luisi**  
  GitHub: [enricoluisi](https://github.com/enricoluisi)  
  <img src="https://github.com/enricoluisi.png" width="100" alt="Enrico's Avatar">

---

## Front-End Examples

Below are some screenshots of the front-end interacting with the backend:

![The front-end performs a GET request to the API to list all posts stored in the database. In this example, a total of 7 posts are returned, displaying their images and associated information](https://github.com/user-attachments/assets/8da59072-788b-439c-8ee7-334471be486f)
*Example of the front-end displaying the posts fetched from the API.*

![Clicking on an image in the front-end displays the caption automatically generated by Google Gemini AI, describing the content of the image](https://github.com/user-attachments/assets/9dddabff-fc40-4486-bac9-e00480449222)
*Another screenshot showing the post creation form and image upload functionality.*


## License
This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.
